<!-- ko if: operation -->

<!-- ko if: working -->
<spinner class="fit"></spinner>
<!-- /ko -->

<!-- ko ifnot: working -->
<div class="animation-fade-in">
    <div class="operation-header">
        <h2 class="operation-name" data-bind="click: $component.openConsole">
            <span data-bind="text: operation().displayName"></span>
        </h2>
        <button class="open-console-btn" data-bind="click: $component.openConsole">Try it <i class="icon icon-play"></i>
        </button>
    </div>

    <!-- ko if: operation().description  -->
    <div class="text-word-break" data-bind="markdown: operation().description"></div>
    <!-- /ko -->

    <!-- ko if: tags().length > 0 -->
    <div class="tag-group">
        <!-- ko foreach: { data: $component.tags, as: 'tag' } -->
        <span class="tag" role="group" data-bind="text: tag"></span>
        <!-- /ko -->
    </div>
    <!-- /ko -->

    <div class="collapsible">
        <h3>Request</h3>
        <div class="collapsible-container">
            <span data-bind="text: $component.requestUrlSample, attr: { 'data-method': operation().method }"></span>

            <!-- ko if: operation().templateParameters.length > 0 -->
            <h4>Request parameters</h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>In</th>
                        <th>Required</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko foreach: { data: operation().templateParameters, as: 'parameter' } -->
                    <tr>
                        <td data-bind="text: parameter.name"></td>
                        <td>path</td>
                        <td data-bind="text: parameter.required"></td>
                        <td data-bind="text: parameter.type"></td>
                        <td data-bind="text: parameter.description"></td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
            <!-- /ko -->

            <!-- ko if: operation().request && operation().request.headers && operation().request.headers.length > 0 -->
            <h4>Request headers</h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Required</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko foreach: { data: operation().request.headers, as: 'header' } -->
                    <tr>
                        <td data-bind="text: header.name"></td>
                        <td data-bind="text: header.required"></td>
                        <td data-bind="text: header.type"></td>
                        <td data-bind="text: header.description"></td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
            <!-- /ko -->


            <!-- ko with: operation().request, as: 'request' -->
            <!-- ko if: request.isMeaningful() -->
            <h4>Request body</h4>

            <!-- ko if: request.representations.length > 0 -->
            <div class="tabs" data-bind="foreach: { data: request.representations, as: 'representation' }">
                <input class="tab-radio" type="radio" name="requestContentType"
                    data-bind="attr : { id: 'request' + representation.contentType, checked: $index() === 0 }">

                <label class="tab-label"
                    data-bind="attr : { for: 'request' + representation.contentType }, text: representation.contentType"></label>

                <div class="tab-content">
                    <!-- ko if: representation.typeName -->
                    <type-definition
                        params="{ representation: representation, definition: $component.getDefinitionByTypeName(representation.typeName) }">
                    </type-definition>
                    <!-- /ko -->
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->

            <!-- /ko -->

            <!-- ko foreach: { data: operation().meaningfulResponses(), as: 'response' } -->
            <h3>Response: <span data-bind="text: response.statusCode"></span></h3>

            <!-- ko if: response.representations.length > 0 -->
            <div class="tabs" data-bind="foreach: { data: representations, as: 'representation' }">
                <input class="tab-radio" type="radio"
                    data-bind="attr : { id: response.identifier + representation.contentType, name: response.identifier, checked: $index() === 0 }">

                <label class="tab-label"
                    data-bind="attr : { for: response.identifier + representation.contentType }, text: representation.contentType"></label>

                <div class="tab-content">
                    <!-- ko if: representation.typeName -->
                    <type-definition
                        params="{ representation: representation, apiName: $component.api().name, operationName: $component.operation().name, definition: $component.getDefinitionByTypeName(representation.typeName) }">
                    </type-definition>
                    <!-- /ko -->
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
        </div>
    </div>

    <!-- ko if: $component.definitions().length > 0 -->
    <h3>Definitions</h3>

    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <!-- ko foreach: { data: definitions, as: 'definition' } -->
            <tr>
                <td>
                    <a
                        data-bind="text: definition.name, attr: { href: $component.getDefinitionReferenceUrl(definition) }"></a>
                </td>
                <td data-bind="markdown: definition.description"></td>
            </tr>
            <!-- /ko -->
        </tbody>
    </table>

    <!-- ko foreach: { data: definitions, as: 'definition' } -->
    <type-definition
        params="{ apiName: $component.api().name, operationName: $component.operation().name, definition: definition, anchor: true }">
    </type-definition>
    <!-- /ko -->
    <!-- /ko -->
</div>
<!-- /ko -->

<!-- /ko -->

<!-- ko if: $component.consoleIsOpen -->
<div class="detachable-right scrollable flex-grow animation-fade-in">
    <operation-console class="test flex flex-column" params="{ api: api, operation: operation }">
    </operation-console>
</div>
<!-- /ko -->